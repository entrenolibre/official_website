// @codekit-append '/partials/general.js';
// @codekit-append '/partials/testimonials.js';
// @codekit-append '/partials/carousel.js';

/* global Modernizr:true */
/* global WOW:true */
/* global meta4delicious_vars:true */
/* global fwForm:true */
/* //global console:true */

jQuery( document ).ready( function($) {

	// Setup strict mode
	(function() {

    "use strict";
    
    var is_rtl = (meta4delicious_vars.is_rtl && meta4delicious_vars.is_rtl !== '') ? true : false;
    
    var wow = new WOW({
      offset: 100,   // default
      mobile: true, // default
      live: true    // default
    });
    wow.init();
    $('.swipebox').swipebox({autoplayVideos: true});
    $('a[data-lightbox="true"]').swipebox({autoplayVideos: true});
    $('select').selectize({
	    'onFocus' : function() {
		    var $container = $($(this)[0].$control[0]).parent();
		    $container.addClass('active');
	    },
	    'onBlur' : function() {
				var $container = $($(this)[0].$control[0]).parent();
		    $container.removeClass('active');
	    }
    });
    $('#main').fitVids();
    $('.format-gallery').find('.owl-carousel').owlCarousel({
	    items: 1,
      margin: 0,
      autoHeight: true,
      autoplay: true,
      autoplayHoverPause: true,
      animateIn: 'fadeIn',
			animateOut: 'fadeOut',
			rtl: is_rtl,
    });


		/* --------------------------------------------------------- */
		/* !Variables */
		/* --------------------------------------------------------- */
		
		var $window = $(window),
				$html = $('html'),
				$header = $('#site-header'),
				$header_spacer = $('#site-header-spacer'),
				$scrolled_header = $('#scrolled-header'),
				$scrolled_header_padding = $('#scrolled-header-padding'),
				$primary_menu = $('.meta4delicious-primary-menu-container'),
				$mobile_menu = $('.meta4delicious-mobile-menu-contents'),
				$menu_toggle = $('#menu-toggle'),
				$admin_bar = $('#wpadminbar'),
				$to_top = $('#to-top'),
				//$hero_wrapper = $('.meta4delicious-hero-enabled').find('section').first().children('.section-wrapper'),
				menu_item_parents = $primary_menu.find('li.menu-item-has-children'),
				menu_items = $primary_menu.find('a'),
				mobile_menu_item_parents = $mobile_menu.find('li.menu-item-has-children'),
				mobile_menu_items = $mobile_menu.find('a'),
				header_h = $header.height(),
				scrolled_header_h = $scrolled_header.outerHeight(),
				last_section_id,
				scroll_top = 0,
				is_scrolled = false,
				is_mobile = false,
				scroll_items = menu_items.map( function() {
					return find_hash_section( $(this).attr('href') );
				});
			
			
		
		/* --------------------------------------------------------- */
		/* !Scroll to section */
		/* --------------------------------------------------------- */
		
		function find_hash_section( url ) {
			
			var hash = url.split('#');
			    
			if( hash[1] ) {
				var $section = $( '#'+hash[1] );
				if( $section[0] ) {
					return $section;
				}
			}
		}
		
		function scroll_to_section( top ) {
			
			$('html, body').stop().animate({
        scrollTop: top
      }, 1000, 'easeInOutQuint');
		}
		
		function init_section_scroll() {
			if( window.location.hash ) {
				var $section = $(window.location.hash);	
				if( $section[0] ) {
					var top = $section.offset().top - scrolled_header_h;
		      scroll_to_section( top );
				}
			}
		}
		
		
		/* --------------------------------------------------------- */
		/* !To top click */
		/* --------------------------------------------------------- */
		
		$to_top.click( function(e) {
			e.preventDefault();
			$('html, body').stop().animate({
        scrollTop: 0
      }, 1000, 'easeInOutQuint');
		});
		
		
		/* --------------------------------------------------------- */
		/* !Menu highlighting on scroll */
		/* --------------------------------------------------------- */
		
		function menu_highlighting() {
			
			// Get container scroll position
			var from_top = scroll_top+scrolled_header_h+1;
			
			// Get id of current scroll item
			var cur = scroll_items.map(function() {
				if( $(this).offset().top < from_top) {
					return this;
				}
			});
			
			// Get the id of the current element
			cur = cur[cur.length-1];
			var id = cur && cur.length ? cur[0].id : '';
			
			if( id === '' ) {
				menu_items.parent().removeClass('active');
			} else {
				last_section_id = id;
				menu_items
					.parent().removeClass('active')
					.end().filter('[href*="#'+id+'"]').parent().addClass('active');
				mobile_menu_items
					.parent().removeClass('active')
					.end().filter('[href*="#'+id+'"]').parent().addClass('active');
			} 
		}
			
		
		/* --------------------------------------------------------- */
		/* !Link clicks */
		/* --------------------------------------------------------- */
		
		function check_link_scroll( $link, e ) {
			
			var url = $link.attr('href'),
			    hash = url.split('#'),
			    window_url = window.location.href.replace(window.location.hash, '');

			window_url = window_url.replace(/\/$/, '');

			if( hash[0] === '' || hash[0].replace(/\/$/, '') === window_url ) {
				
				if( hash[1] ) {
					
					var $section = $( '#'+hash[1] );
					
					if( $section[0] ) {
						
						e.preventDefault();
						
						resize_calculations();
						var top = $section.offset().top - scrolled_header_h;
			      scroll_to_section( top );
			      
			      return;
						
					}
				}	
			}
		}
		
		$('.meta4delicious-primary-menu-container a, .meta4delicious-mobile-menu-container a').click( function(e) {
			if( $(this).parents('.meta4delicious-mobile-menu-contents').length > 0 && $(this).parent().hasClass('menu-item-has-children') ) {
				return;
			}
			check_link_scroll( $(this), e );		
    });
		
		$(document).on( 'click', 'a.meta4scroll, .buttonSlider + a, .slider-btn + a', function(e) {
			check_link_scroll( $(this), e );		
    });
    
    
    
    /* --------------------------------------------------------- */
    /* !Primary sub menus */
    /* --------------------------------------------------------- */
    
    function show_sub_menu( $item ) {
	    
	    // Remove any current timer classes
		  $item.removeClass('menu-timer-active');
		  
		  // Reset siblings
		  hide_sub_menu_siblings( $item );
	    
	    var $parent = $item.parent(),
			  	$sub = $item.children('ul');
	    
	    if( $parent.hasClass('sub-menu') ) {
			  $sub.css({
				  'display': 'block',
				  'top' : 0,
				  'left': $item.outerWidth()
			  });
			  $sub.stop().animate( {
			  	opacity: 1,
			  	marginLeft: 0
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			  	// Animation complete.
			  });
		  } else {
			  $sub.css({
				  'display': 'block',
				  'left': 0
			  });
			  $sub.stop().animate( {
			  	opacity: 1,
			  	marginTop: 0
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			  	// Animation complete.
			  });
		  }
    }
    
    function hide_sub_menu( $parent, $sub ) {
	   	
	   	if( $parent.hasClass('sub-menu') ) {
		   	
		   	var margin = $parent.parent().hasClass('menu-timer-active') ? 0 : '10px';
		   	
			  $sub.stop().animate( {
			  	opacity: 0,
			  	marginLeft: margin
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			  	$sub.css({
					  'display': 'none'
				  });
			  });
		  } else {
			  $sub.stop().animate( {
			  	opacity: 0,
			  	//marginTop: '-5px'
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			  	$sub.css({
					  'display': 'none'
				  });
			  });
		  } 
    }
    
    function hide_sub_menu_siblings( $item ) {
	   	
	   	$item.siblings().each( function() {
		   	
		   	var $sibling = $(this);

		   	if( $sibling.hasClass('menu-item-has-children') ) {
			   	
			   	// Remove any current timer classes
			   	$sibling.removeClass('menu-timer-active');
		   	
			   	var $parent = $sibling.parent(), 
			   			$sub = $sibling.children('ul');
			  		
			  	hide_sub_menu( $parent, $sub );
			  }
	   		
	   	});   	
    }
    
		menu_item_parents.hover(
		  function () {
			  
			  // Show the sub menu
			  show_sub_menu( $(this) );  
		  }, 
		  function () {
			  
			  var $item = $(this),
			  		$parent = $item.parent(),
			  		$sub = $item.children('ul');
			  					  
			  // Add a timer class		
			  $item.addClass('menu-timer-active');
			  		
			  setTimeout( function() {
				  
				  // Check for the timer class
				  if( $item.hasClass('menu-timer-active') ) {
				  	hide_sub_menu( $parent, $sub );
				  }
				  
				}, meta4delicious_vars.menus.hide_delay);

		  }
		);
		
		
		/* --------------------------------------------------------- */
    /* !Mobile sub menus */
    /* --------------------------------------------------------- */
    
    function init_mobile_subs() {
	    mobile_menu_item_parents.each( function(index) {
		    
		    var $parent_ul = $(this).parent(),
		    		$sub_ul = $(this).children('ul'),
		    		$link = $(this).children('a').clone(),
						$link_li = $('<li class="mobile-link-heading"></li>'),
						$back_link = $('<a href="#">'+meta4delicious_vars.menus.back_str+'</a>'),
						$back_li = $('<li class="mobile-menu-back"></li>');
				
				$back_li.append($back_link);	
				$link_li.append($link);
				$sub_ul.prepend($back_li, $link_li);
				
				// Add custom selectors
		    $(this).children('a').attr('href', '#mobile-menu-'+index);
		    
		    $sub_ul.attr('id', 'mobile-menu-'+index);
				
				$back_link.click( function(e) {
					e.preventDefault();
					hide_sub_menu_mobile($parent_ul, $sub_ul);
				});	
				
				$link.click( function() {
					hide_mobile_menu();
				});	
		    
		    // Move the submenu
		    $mobile_menu.append( $(this).children('ul') );
	    });
	    
    }
    
    function show_mobile_menu() {
	    $menu_toggle.addClass('active');
			$html.addClass('mobile-menu-active');
			$mobile_menu.find('ul').not('.sub-menu').show();
			$mobile_menu.stop().css({
				height: $mobile_menu.find('ul').not('.sub-menu').outerHeight()+'px'
			});
    }
    
    function hide_mobile_menu() {
	    $menu_toggle.removeClass('active');
			$html.removeClass('mobile-menu-active');
			reset_sub_menus_mobile();
    }

    function show_sub_menu_mobile( $li, $sub_ul ) {
			
			var $parent_ul = $li.parent();
			
			$parent_ul.children('li').each( function() {	
				$(this).children('a').stop().animate( {
			  	marginLeft: '-50px',
			  	opacity: 0
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			  	$parent_ul.hide();
			  });	
			});
			
			$sub_ul.show();
			$sub_ul.children('li').each( function(index) {
				$(this).children('a').css({
				  'display': 'inline-block',
				  opacity: 0
			  });
				$(this).children('a').stop().delay(index*100).animate( {
			  	marginLeft: 0,
			  	opacity: 1
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
					// Animation complete.
			  });
			});
			
			var sub_h = $sub_ul.outerHeight();
			
			$mobile_menu.stop().animate( {
				height: sub_h+'px'
			}, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
				// Animation complete.
			});
    }
    
    function hide_sub_menu_mobile( $parent_ul, $sub_ul ) {

			$sub_ul.children('li').each( function() {	
				$(this).children('a').stop().animate( {
			  	marginLeft: '50px',
			  	opacity: 0
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			  	$sub_ul.hide();
			  });	
			});
			
			$parent_ul.show();
			$parent_ul.children('li').each( function(index) {
				$(this).children('a').css({
				  'display': 'inline-block',
				  'opacity': 0
			  });
				$(this).children('a').stop().delay(index*100).animate( {
			  	marginLeft: 0,
			  	opacity: 1
			  }, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
					// Animation complete.
			  });
			});
			
			var parent_h = $parent_ul.outerHeight();
			
			$mobile_menu.stop().animate( {
				height: parent_h+'px'
			}, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
				// Animation complete.
			});
    }
    
    function reset_sub_menus_mobile() {
	   	
	   	$mobile_menu.find('ul').not('.sub-menu').show();
	   	$mobile_menu.find('a').stop().css({
		   	'display': 'inline-block',
		   	'marginLeft': 0,
		   	'opacity': 1,
	   	});  
	   	
	   	$mobile_menu.find('ul.sub-menu').hide();
	   	$mobile_menu.find('.sub-menu').find('a').stop().css({
		   	'display': 'none',
		   	'marginLeft': '50px',
		   	'opacity': 0,
	   	});	
	   	
	   	var h = $mobile_menu.find('ul').not('.sub-menu').outerHeight();
			$mobile_menu.stop().css('height', h+'px');
    }
    
    $menu_toggle.click( function(e) {
			e.preventDefault();
			if( $(this).hasClass('active') ) {
				hide_mobile_menu();
			} else {
				show_mobile_menu();
			}
		});
		
		mobile_menu_items.click( function(e) {
			
			if( $(this).parent().hasClass('menu-item-has-children') ) {
				e.preventDefault();
				show_sub_menu_mobile( $(this).parent(), $($(this).attr('href')) );
			} else {
				hide_mobile_menu();
			}

		});
		
		init_mobile_subs();
		
		$mobile_menu.stop().animate( {
			height: $mobile_menu.children('ul').outerHeight()+'px'
		}, meta4delicious_vars.menus.anim_speed, meta4delicious_vars.menus.ease, function() {
			// Animation complete.
		});
    
    
    /* --------------------------------------------------------- */
    /* !Header resizing */
    /* --------------------------------------------------------- */
    
    function show_scrolled_header() {
	    
	    if( Modernizr.mq('(min-width: 992px)') ) {
		    
		    $scrolled_header_padding.stop().animate( {
		    	marginTop: '0'
		    }, 500, 'easeOutExpo', function() {
		    	// Animation complete.
		    });
	    }
    }
    
    function hide_scrolled_header( noanim ) {

	    if( noanim ) {
		    $scrolled_header_padding.css({
			    marginTop: '-'+$scrolled_header_padding.outerHeight()+'px'
		    });
		    
		  } else {
			  $scrolled_header_padding.stop().animate( {
		    	marginTop: '-'+$scrolled_header_padding.outerHeight()+'px'
		    }, 500, 'easeOutExpo', function() {
		    	// Animation complete.
		    });
		  }
    }
    
    function window_scrolling() {
	    
	    var scroll_top = $window.scrollTop();
	    if( scroll_top > $header.height() ) { 
		    if( !is_scrolled ) {
			    is_scrolled = true;
			    $('body').addClass('core-scrolled');
			    show_scrolled_header();
		    }

	    } else {
		    if( is_scrolled ) {
			    is_scrolled = false;
			    $('body').removeClass('core-scrolled');
			    hide_scrolled_header();
		    }
	    }	
	    
    }
    
    
    /* --------------------------------------------------------- */
		/* !Content padding */
		/* --------------------------------------------------------- */
		
		function resize_calculations() {	
			
			if( Modernizr.mq('(min-width: 992px)') ) {
				if( is_mobile ) {
					var scroll_top = $window.scrollTop();
			    if( scroll_top > $header.height() ) { 
				    is_scrolled = true;
				    $('body').addClass('core-scrolled');
				    show_scrolled_header();
			    } else {
				    is_scrolled = false;
				    $('body').removeClass('core-scrolled');
				    hide_scrolled_header();
			    }	
				}
				is_mobile = false;
			} else {
				is_mobile = true;
			}
			
			header_h = $header.height();
			scrolled_header_h = $scrolled_header_padding.outerHeight();
			
			// Set the header spacer height
/*
			if( init ) {
				$header_spacer.delay(500).animate( {
					height: header_h+'px'
				}, 500, 'easeOutExpo', function() {
					// Animation complete.
				});
			} else {
*/
				$header_spacer.stop().height(header_h);
			//}
			
			if( $admin_bar.length && Modernizr.mq('(min-width: 601px)') ) {
				scrolled_header_h += $admin_bar.outerHeight();
			}
		}
		

    
    /* --------------------------------------------------------- */
    /* !Form labels */
    /* --------------------------------------------------------- */ 
    
    fwForm.initAjaxSubmit({
        //selector: 'form[some-custom-attribute].or-some-class'

        // Open the script code and check the `opts` variable
        // to see all options that you can overwrite/customize.
      loading: function (elements, show) {

				elements.$form.css('position', 'relative');
				elements.$form.find('> .fw-form-loading').remove();

				if (show) {
					elements.$form.append(
						'<div class="fw-form-loading"></div>'
					);
				}
			},
    });
    
    $('.meta4delicious-form-item.field-text, .meta4delicious-form-item.field-email, .meta4delicious-form-item.field-textarea, .meta4delicious-form-item.field-number, .meta4delicious-form-item.field-website, .meta4delicious-form-item.field-phone').each( function() {
	    
	  	var $container = $(this),
	  			$input = $(this).find('input, textarea');
	    
			if( $input.val() !== '' ) {
				$container.addClass('show-label');
			}
			
			$input.keyup(function() {
			  if( $input.val() === '' ) {
					$container.removeClass('show-label');
				} else {
					$container.addClass('show-label');
				}
			});
	    
    });
    
		
		/* --------------------------------------------------------- */
		/* !Add custom hover classes for layerslider */
		/* --------------------------------------------------------- */
		
		$('.ls-layer-link').live( 'mouseover', function() {
			$(this).prev().addClass('ls-layer-link-hover');
		}).live( 'mouseout', function() {
			$(this).prev().removeClass('ls-layer-link-hover');
		});
    

    /* --------------------------------------------------------- */
    /* !Window scroll & resize events */
    /* --------------------------------------------------------- */
    
    $('#site-header, #scrolled-header').imagesLoaded( function() {
		  resize_calculations();
		  init_section_scroll();
		});
    
    $('body').bind('mousewheel', function() {
		  $('html, body').stop();
	  });
    
    // Bind to scroll
		$window.scroll( function() {
			scroll_top = $window.scrollTop();
			menu_highlighting();	
			window_scrolling();                  
		});
		
    $window.resize( function() {
	    resize_calculations();
    });
    resize_calculations();
    hide_scrolled_header( true );
    init_section_scroll();
    window_scrolling(); 
    
    // Add the init class
    $('body').addClass('meta4delicious-init');
    
 
	}());

});

/* //global console:true */

jQuery( document ).ready( function($) {

	// Setup strict mode
	(function() {

    "use strict";
    
    var visible_offset = 100;
    
    function is_visible( $el ) {
		  var win_top = $(window).scrollTop(),
		  		win_bottom = win_top + $(window).height(),
					el_top = $el.offset().top,
					el_bottom = el_top + $el.height();
					
		  return ( (el_top <= (win_bottom-visible_offset)) && (el_bottom >= (win_top+visible_offset)) );
		}
    
    $('.fw-testimonials').each( function() {
	    
	    var $testimonials = $(this),
	    		$testimonials_list = $testimonials.find('.fw-testimonials-list'),
	    		testimonials_items = $testimonials.find('.fw-testimonials-item'),
	    		testimonials_nav = $testimonials.find('.meta4delicious-nav'),
	    		testimonials_current = -1,
	    		$testimonials_prev = $testimonials.find('.meta4delicious-prev'),
	    		$testimonials_next = $testimonials.find('.meta4delicious-next'),	
	    		testimonials_delay = parseInt( $testimonials.data('delay') ),
	    		testimonials_auto_rotate = (testimonials_delay !== 0) ? true : false,
	    		testimonials_rotator,
	    		testimonials_rotator_running = false;
	    		
	    function testimonials_list_resize() {
		    
		    $testimonials_list.stop().animate( {
		    	height: $(testimonials_items[testimonials_current]).height()+'px'
		    }, 250, 'easeOutExpo', function() {
		    	// Animation complete.
		    });
	    }
	    
	    function testimonials_goto( next ) {
		    
		    if( next !== testimonials_current ) {
			    
			    if( testimonials_auto_rotate ) {
						testimonials_stop_timer();
					}
					
					testimonials_items.removeClass('active');
					testimonials_nav.removeClass('active');
			    testimonials_current = next;
			    
			    $testimonials_list.stop().animate( {
			    	height: $(testimonials_items[testimonials_current]).height()+'px'
			    }, 250, 'easeOutExpo', function() {
			    	// Animation complete.
			    });
			    
			    $(testimonials_items[testimonials_current]).addClass('active');
			    $(testimonials_nav[testimonials_current]).addClass('active');
			    
			    if( testimonials_auto_rotate ) {
			    	testimonials_start_timer();
			    }
		    }
	    }
	    		
			function testimonials_prev() {
				
				var testimonials_new = testimonials_current - 1;
		    if( testimonials_new < 0 ) {
			    testimonials_new = testimonials_items.length - 1;
		    }
		    testimonials_goto( testimonials_new );
			}
			
	    function testimonials_next() {

		    var testimonials_new = testimonials_current + 1;
		    if( testimonials_new >= testimonials_items.length ) {
			    testimonials_new = 0;
		    }
		    testimonials_goto( testimonials_new );
	    }
	    
	    function testimonials_start_timer() {
		    testimonials_rotator_running = true;
		    testimonials_rotator = setInterval(function() {
			    testimonials_next();
		  	}, 1000*testimonials_delay );
	    }
	    
	    function testimonials_stop_timer() {
		    testimonials_rotator_running = false;
		    clearInterval( testimonials_rotator );
	    }
	    		
	    $testimonials_prev.click( function(e) {
		    e.preventDefault();
		    testimonials_prev(); 
	    });
	    
	    $testimonials_next.click( function(e) {
		    e.preventDefault();
		    testimonials_next();
	    });
	    
	    testimonials_nav.click( function(e) {
		    e.preventDefault();
		    testimonials_goto( $(this).data('index') );
	    });
	    
	    $testimonials_list.stop().animate( {
	    	height: $(testimonials_items[testimonials_current]).height()+'px'
	    }, 250, 'easeOutExpo', function() {
	    	// Animation complete.
	    });
	    
	    if( is_visible($testimonials) && testimonials_auto_rotate ) { 
		    testimonials_start_timer();
	    }
	    
	    // Make sure the auto rotate stops when out of viewport
			$(window).scroll( function() {
				if( testimonials_auto_rotate ) {
					if( is_visible($testimonials) ) {
						if( !testimonials_rotator_running ) {
				    	testimonials_start_timer();
				    }
					} else {	
						if( testimonials_rotator_running ) {
				    	testimonials_stop_timer();
				    }
					} 
				}               
			});
			
			$(window).resize( function() {
		    testimonials_list_resize();
	    });
	    
	    testimonials_goto( 0 );
	    
    });
    
 
	}());

});

/* global Modernizr:true */
/* global meta4delicious_vars:true */
/* //global console:true */

jQuery( document ).ready( function($) {

	// Setup strict mode
	(function() {

    "use strict";
    
    var is_rtl = (meta4delicious_vars.is_rtl && meta4delicious_vars.is_rtl !== '') ? true : false;
 
		$('.meta4-carousel').each( function() {
    	
    	var $carousel = $(this),
    			autoplayTimeout = parseInt( $carousel.data('delay') ),
    			autoplay = (autoplayTimeout !== 0) ? true : false;

	    $carousel.owlCarousel({
		    center:true,
		    loop: true,
		    nav: true,
		    navClass: ['meta4delicious-prev','meta4delicious-next'],
		    navText: ['<i class="fa fa-angle-left"></i>','<i class="fa fa-angle-right"></i>'],
		    dots: false,
		    autoplay: autoplay,
		    autoplayTimeout: autoplayTimeout*1000,
		    smartSpeed: 500,
		    rtl: is_rtl,
		    responsive: {
		      0:{
		        items:1,
		        margin: 20,
		      },
		      768:{
		        items:2,
		        margin: 20,
		      },
		      1200:{
		        items:3,
		        margin: 5,
		      }
		    },
			});
		
		});
    
 
	}());

});

